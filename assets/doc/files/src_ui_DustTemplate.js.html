<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/ui/DustTemplate.js - lavaca</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="lavaca"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 2.3.2</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/lavaca.env.Device.html">lavaca.env.Device</a></li>
            
                <li><a href="../classes/lavaca.events.EventDispatcher.html">lavaca.events.EventDispatcher</a></li>
            
                <li><a href="../classes/lavaca.fx.Animation.html">lavaca.fx.Animation</a></li>
            
                <li><a href="../classes/lavaca.fx.Spring.html">lavaca.fx.Spring</a></li>
            
                <li><a href="../classes/lavaca.fx.Transform.html">lavaca.fx.Transform</a></li>
            
                <li><a href="../classes/lavaca.fx.Transition.html">lavaca.fx.Transition</a></li>
            
                <li><a href="../classes/lavaca.mvc.Application.html">lavaca.mvc.Application</a></li>
            
                <li><a href="../classes/lavaca.mvc.AttributeEvent.html">lavaca.mvc.AttributeEvent</a></li>
            
                <li><a href="../classes/lavaca.mvc.Collection.html">lavaca.mvc.Collection</a></li>
            
                <li><a href="../classes/lavaca.mvc.Controller.html">lavaca.mvc.Controller</a></li>
            
                <li><a href="../classes/lavaca.mvc.ItemEvent.html">lavaca.mvc.ItemEvent</a></li>
            
                <li><a href="../classes/lavaca.mvc.Model.html">lavaca.mvc.Model</a></li>
            
                <li><a href="../classes/lavaca.mvc.Route.html">lavaca.mvc.Route</a></li>
            
                <li><a href="../classes/lavaca.mvc.Router.html">lavaca.mvc.Router</a></li>
            
                <li><a href="../classes/lavaca.mvc.View.html">lavaca.mvc.View</a></li>
            
                <li><a href="../classes/lavaca.mvc.ViewManager.html">lavaca.mvc.ViewManager</a></li>
            
                <li><a href="../classes/lavaca.net.Connectivity.html">lavaca.net.Connectivity</a></li>
            
                <li><a href="../classes/lavaca.net.History.html">lavaca.net.History</a></li>
            
                <li><a href="../classes/lavaca.storage.LocalStore.html">lavaca.storage.LocalStore</a></li>
            
                <li><a href="../classes/lavaca.storage.Store.html">lavaca.storage.Store</a></li>
            
                <li><a href="../classes/lavaca.ui.DustTemplate.html">lavaca.ui.DustTemplate</a></li>
            
                <li><a href="../classes/lavaca.ui.Form.html">lavaca.ui.Form</a></li>
            
                <li><a href="../classes/lavaca.ui.LoadingIndicator.html">lavaca.ui.LoadingIndicator</a></li>
            
                <li><a href="../classes/lavaca.ui.Template.html">lavaca.ui.Template</a></li>
            
                <li><a href="../classes/lavaca.ui.Widget.html">lavaca.ui.Widget</a></li>
            
                <li><a href="../classes/lavaca.util.ArrayUtils.html">lavaca.util.ArrayUtils</a></li>
            
                <li><a href="../classes/lavaca.util.Cache.html">lavaca.util.Cache</a></li>
            
                <li><a href="../classes/lavaca.util.Config.html">lavaca.util.Config</a></li>
            
                <li><a href="../classes/lavaca.util.DateUtils.html">lavaca.util.DateUtils</a></li>
            
                <li><a href="../classes/lavaca.util.Disposable.html">lavaca.util.Disposable</a></li>
            
                <li><a href="../classes/lavaca.util.extend.html">lavaca.util.extend</a></li>
            
                <li><a href="../classes/lavaca.util.Map.html">lavaca.util.Map</a></li>
            
                <li><a href="../classes/lavaca.util.Promise.html">lavaca.util.Promise</a></li>
            
                <li><a href="../classes/lavaca.util.resolve.html">lavaca.util.resolve</a></li>
            
                <li><a href="../classes/lavaca.util.StringUtils.html">lavaca.util.StringUtils</a></li>
            
                <li><a href="../classes/lavaca.util.Translation.html">lavaca.util.Translation</a></li>
            
                <li><a href="../classes/lavaca.util.uuid.html">lavaca.util.uuid</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src/ui/DustTemplate.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
define(function(require) {

  var dust = require(&#x27;dust&#x27;),
      Template = require(&#x27;lavaca/ui/Template&#x27;),
      Config = require(&#x27;lavaca/util/Config&#x27;),
      Promise = require(&#x27;lavaca/util/Promise&#x27;),
      StringUtils = require(&#x27;lavaca/util/StringUtils&#x27;),
      Translation = require(&#x27;lavaca/util/Translation&#x27;);
  require(&#x27;dust-helpers&#x27;);

  /**
   * Base type for templates that use the dust engine
   * @class lavaca.ui.DustTemplate
   * @extends lavaca.ui.Template
   *
   * @constructor
   * @param {String} name  The unique name of the template
   * @param {String} src  A URL from which to load the template
   * @param {String} code  The raw string code of the template&#x27;s body
   */
  var DustTemplate = Template.extend(function() {
    Template.apply(this, arguments);
    var helper = this.prepareHelpers(),
        n;
    if(!dust.helpers) {
      dust.helpers = [];
    }
    for (n in helper) {
      dust.helpers[n] = helper[n];
    }
  }, {
    /**
     * Gets the basis for the template helper object
     * @method prepareHelpers
     *
     * @return {Object}  A map of helper function names to functions
     */
    prepareHelpers: function() {
      return {
        msg: this.helperMsg,
        include: this.helperInclude,
        config: this.helperConfig
      };
    },
    /**
     * Helper function, exposed in dust templates, that uses
     *   [Lavaca.util.Translation] to get localized strings.
     * Accessed as:
     *
     * &lt;dl&gt;
     *
     * &lt;dt&gt;{@msg key=&quot;code&quot;/}&lt;/dt&gt;
     *   &lt;dd&gt;code&amp;mdash;The key under which the message is stored&lt;/dd&gt;
     *
     * &lt;dt&gt;{@msg key=&quot;code&quot;}default{/msg}&lt;/dt&gt;
     *   &lt;dd&gt;code&amp;mdash;The key under which the message is stored&lt;/dd&gt;
     *   &lt;dd&gt;default&amp;mdash;The default markup to display if no translation
     *       is found&lt;/dd&gt;
     *
     *
     * &lt;dt&gt;{@msg key=&quot;code&quot; locale=&quot;en_US&quot;/}&lt;/dt&gt;
     *   &lt;dd&gt;code&amp;mdash;The key under which the message is stored&lt;/dd&gt;
     *   &lt;dd&gt;locale&amp;mdash;The locale from which to get the message (&quot;en_US&quot;)&lt;/dd&gt;
     *
     * &lt;dt&gt;{@msg key=&quot;code&quot; p0=&quot;first&quot; p1=variable /}&lt;/dt&gt;
     *   &lt;dd&gt;code&amp;mdash;The key under which the message is stored&lt;/dd&gt;
     *   &lt;dd&gt;p0, p1, &amp;hellip; pN&amp;mdash;String format parameters for the message
     *       (See [[Lavaca.util.StringUtils]].format())&lt;/dd&gt;
     *
     * &lt;/dl&gt;
     *
     * @method helperMsg
     *
     * @param {Object} chunk  Dust chunk
     * @param {Object} context  Dust context
     * @param {Object} bodies  Dust bodies
     * @param {Object} params  Parameters passed to the helper
     * @return {String}  Rendered output
     */
    helperMsg: function(chunk, context, bodies, params) {
      var key = dust.helpers.tap(params.key, chunk, context),
          locale = dust.helpers.tap(params.locale, chunk, context),
          translation = Translation.get(key, locale),
          args = [translation],
          i = -1,
          arg;
      if(!translation) {
        return bodies.block ? chunk.render(bodies.block, context) : chunk;
      }
      arg = params[&#x27;p&#x27; + (++i)];
      while (typeof arg !== &#x27;undefined&#x27;) {
        args.push(dust.helpers.tap(arg, chunk, context));
        arg = params[&#x27;p&#x27; + (++i)];
      }
      return chunk.write(StringUtils.format.apply(this, args));
    },
    /**     
     * Helper function, exposed in dust templates, that uses
     *   [[Lavaca.ui.Template]] to include other templates. Accessed as:
     *
     * &lt;dl&gt;
     *
     * &lt;dt&gt;{@include name=&quot;template-name&quot;/}&lt;/dt&gt;
     *   &lt;dd&gt;name&amp;mdash;The name under which the template can be referenced&lt;/dd&gt;
     *
     * &lt;/dl&gt;
     *
     * &lt;strong&gt;Note:&lt;/strong&gt; You should always use the include helper instead of
     * the dust.js partial syntax. The dust.js partial syntax may not work as expected.
     *
     * @method helperInclude
     * @param {Object} chunk  Dust chunk
     * @param {Object} context  Dust context
     * @param {Object} bodies  Dust bodies
     * @param {Object} params  Parameters passed to the helper
     * @return {String}  Rendered output
     */
    helperInclude: function(chunk, context, bodies, params) {
      var name = dust.helpers.tap(params.name, chunk, context),
          result;

      // Note that this only works because
      // dust renders are synchronous so
      // the .then() is called before this
      // helper function returns
      Template
        .render(name, context.stack.head)
        .then(function(html) {
          result = html;
        });
      return chunk.write(result);
    },
    /**
     * Helper function, exposed in dust templates, that allows templates
     *   to use data from [[Lavaca.util.Config]]. Accessed as:
     *
     * &lt;dl&gt;
     *
     * &lt;dt&gt;{@config key=&quot;config_value&quot;/}&lt;/dt&gt;
     *   &lt;dd&gt;key&amp;mdash;The key to read from the config file for the default environment.&lt;/dd&gt;
     *
     * &lt;dt&gt;{@config key=&quot;config_value&quot; environment=&quot;production&quot;/}&lt;/dt&gt;
     *   &lt;dd&gt;key&amp;mdash;The key to read from the config file for the specified environment.&lt;/dd&gt;
     *
     * &lt;dt&gt;{@config key=&quot;config_value&quot;}default{/config}&lt;/dt&gt;
     *   &lt;dd&gt;key&amp;mdash;The key to read from the config file&lt;/dd&gt;
     *   &lt;dd&gt;default&amp;mdash;The default markup to display if the key
     *       is not found&lt;/dd&gt;
     *
     * &lt;dt&gt;{@config key=&quot;config_value&quot; p0=&quot;first&quot; p1=variable /}&lt;/dt&gt;
     *   &lt;dd&gt;key&amp;mdash;The key to read from the config file&lt;/dd&gt;
     *   &lt;dd&gt;p0, p1, &amp;hellip; pN&amp;mdash;String format parameters
     *       (See [[Lavaca.util.StringUtils]].format())&lt;/dd&gt;
     *
     * &lt;/dl&gt;
     *
     * &lt;dt&gt;{@config only=&quot;local&quot;}&amp;hellip;{:else}&amp;hellip;{/config}&lt;/dt&gt;
     *   &lt;dd&gt;only&amp;mdash;Only render the body content if the current config environment&#x27;s name matches this key&lt;/dd&gt;
     *
     * &lt;/dl&gt;
     *
     * &lt;dt&gt;{@config not=&quot;production&quot;}&amp;hellip;{:else}&amp;hellip;{/config}&lt;/dt&gt;
     *   &lt;dd&gt;not&amp;mdash;Only render the body content if the current config environment&#x27;s name does NOT match this key&lt;/dd&gt;
     *
     * &lt;/dl&gt;
     * @method helperConfig
     *
     * @param {Object} chunk  Dust chunk
     * @param {Object} context  Dust context
     * @param {Object} bodies  Dust bodies
     * @param {Object} params  Parameters passed to the helper
     * @return {String}  Rendered output
     */
    helperConfig: function(chunk, context, bodies, params) {
      var key = dust.helpers.tap(params.key, chunk, context),
          environment = dust.helpers.tap(params.environment, chunk, context),
          value = environment ? Config.get(environment, key) : Config.get(key),
          args = [value],
          i = -1,
          currentEnvironment, arg;
      if(params.only || params.not) {
        currentEnvironment = Config.currentEnvironment();
        if((params.only &amp;&amp; currentEnvironment === params.only) || (params.not &amp;&amp; currentEnvironment !== params.not)) {
          return bodies.block ? chunk.render(bodies.block, context) : chunk;
        } else {
          return bodies[&#x27;else&#x27;] ? chunk.render(bodies[&#x27;else&#x27;], context) : chunk;
        }
      }
      if(!value) {
        return bodies.block ? chunk.render(bodies.block, context) : chunk;
      }
      arg = params[&#x27;p&#x27; + (++i)];
      while (typeof arg !== &#x27;undefined&#x27;) {
        args.push(dust.helpers.tap(arg, chunk, context));
        arg = params[&#x27;p&#x27; + (++i)];
      }
      return chunk.write(StringUtils.format.apply(this, args));
    },
    /**
     * Compiles the template
     * @method compile
     */
    compile: function() {
      dust.loadSource(dust.compile(this.code, this.name));
    },
    /**
     * Renders the template to a string.
     * @method render
     *
     * @param {Object} model  The data model to provide to the template
     * @return {Lavaca.util.Promise}  A promise
     */
    render: function(model) {
      var promise = new Promise(this);
      if (!this.code &amp;&amp; this.src) {
        this.load(this.src);
      }
      if (this.code &amp;&amp; !this.compiled) {
        this.compile();
        this.compiled = true;
      }
      dust.render(this.name, model, function(err, html) {
        if (err) {
          promise.reject(err);
        } else {
          promise.resolve(html);
        }
      });
      return promise;
    },
    /**
     * Makes this template ready for disposals
     * @method dispose
     */
    dispose: function() {
      delete dust.cache[this.name];
      Template.prototype.dispose.call(this);
    }
  });

  DustTemplate.getCompiledTemplates = function() {
    return dust.cache;
  };

  // Register the Dust template type for later use
  Template.register(&#x27;text/dust-template&#x27;, DustTemplate);

  return DustTemplate;

});

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
