<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/mvc/Application.js - lavaca</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="lavaca"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 2.3.2</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/lavaca.env.Device.html">lavaca.env.Device</a></li>
            
                <li><a href="../classes/lavaca.events.EventDispatcher.html">lavaca.events.EventDispatcher</a></li>
            
                <li><a href="../classes/lavaca.fx.Animation.html">lavaca.fx.Animation</a></li>
            
                <li><a href="../classes/lavaca.fx.Spring.html">lavaca.fx.Spring</a></li>
            
                <li><a href="../classes/lavaca.fx.Transform.html">lavaca.fx.Transform</a></li>
            
                <li><a href="../classes/lavaca.fx.Transition.html">lavaca.fx.Transition</a></li>
            
                <li><a href="../classes/lavaca.mvc.Application.html">lavaca.mvc.Application</a></li>
            
                <li><a href="../classes/lavaca.mvc.AttributeEvent.html">lavaca.mvc.AttributeEvent</a></li>
            
                <li><a href="../classes/lavaca.mvc.Collection.html">lavaca.mvc.Collection</a></li>
            
                <li><a href="../classes/lavaca.mvc.Controller.html">lavaca.mvc.Controller</a></li>
            
                <li><a href="../classes/lavaca.mvc.ItemEvent.html">lavaca.mvc.ItemEvent</a></li>
            
                <li><a href="../classes/lavaca.mvc.Model.html">lavaca.mvc.Model</a></li>
            
                <li><a href="../classes/lavaca.mvc.Route.html">lavaca.mvc.Route</a></li>
            
                <li><a href="../classes/lavaca.mvc.Router.html">lavaca.mvc.Router</a></li>
            
                <li><a href="../classes/lavaca.mvc.View.html">lavaca.mvc.View</a></li>
            
                <li><a href="../classes/lavaca.mvc.ViewManager.html">lavaca.mvc.ViewManager</a></li>
            
                <li><a href="../classes/lavaca.net.Connectivity.html">lavaca.net.Connectivity</a></li>
            
                <li><a href="../classes/lavaca.net.History.html">lavaca.net.History</a></li>
            
                <li><a href="../classes/lavaca.ui.LoadingIndicator.html">lavaca.ui.LoadingIndicator</a></li>
            
                <li><a href="../classes/lavaca.ui.Widget.html">lavaca.ui.Widget</a></li>
            
                <li><a href="../classes/lavaca.util.Cache.html">lavaca.util.Cache</a></li>
            
                <li><a href="../classes/lavaca.util.Disposable.html">lavaca.util.Disposable</a></li>
            
                <li><a href="../classes/lavaca.util.extend.html">lavaca.util.extend</a></li>
            
                <li><a href="../classes/lavaca.util.uuid.html">lavaca.util.uuid</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src/mvc/Application.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
define(function(require) {

  var $ = require(&#x27;$&#x27;),
    History = require(&#x27;lavaca/net/History&#x27;),
    Device = require(&#x27;lavaca/env/Device&#x27;),
    EventDispatcher = require(&#x27;lavaca/events/EventDispatcher&#x27;),
    router = require(&#x27;lavaca/mvc/Router&#x27;),
    viewManager = require(&#x27;lavaca/mvc/ViewManager&#x27;),
    Connectivity = require(&#x27;lavaca/net/Connectivity&#x27;);

  function _stopEvent(e) {
    e.preventDefault();
    e.stopPropagation();
  }

  function _matchHashRoute(hash) {
    var matches = decodeURIComponent(hash).match(/^(?:#)(\/.*)#?@?/);
    if (matches instanceof Array &amp;&amp; matches[1]) {
      return matches[1].replace(/#.*/, &#x27;&#x27;);
    }
    return null;
  }

  function _isExternal(url) {
    var match = url.match(/^([^:\/?#]+:)?(?:\/\/([^\/?#]*))?([^?#]+)?(\?[^#]*)?(#.*)?/);
    if (typeof match[1] === &#x27;string&#x27;
        &amp;&amp; match[1].length &gt; 0
        &amp;&amp; match[1].toLowerCase() !== location.protocol) {
      return true;
    }
    if (typeof match[2] === &#x27;string&#x27;
        &amp;&amp; match[2].length &gt; 0
        &amp;&amp; match[2].replace(new RegExp(&#x27;:(&#x27;+{&#x27;http:&#x27;:80,&#x27;https:&#x27;:443}[location.protocol]+&#x27;)?$&#x27;), &#x27;&#x27;) !== location.host) {
      return true;
    }
    return false;
  }

  /**
   * Base application type
   * @class lavaca.mvc.Application
   * @extends lavaca.events.EventDispatcher
   *
   */
   /**
   * Creates an application
   * @constructor
   * @param {Function} [callback]  A callback to execute when the application is initialized but not yet ready
   */
  var Application = EventDispatcher.extend(function(callback) {
    if (callback) {
      this._callback = callback.bind(this);
    }
    Device.init(function() {
      this.beforeInit()
        .then(this.init.bind(this));
    }.bind(this));
  }, {
    /**
     * The default URL that the app will navigate to
     * @property initRoute
     * @default &#x27;/&#x27;
     *
     * @type String
     */

    initRoute: &#x27;/&#x27;,
    /**
     * The default state object to supply the initial route
     * @property initState
     * @default null
     *
     * @type {Object}
     */
    initState: null,
    /**
     * The default params object to supply the initial route
     * @property initParams
     * @default null
     *
     * @type {Object}
     */

    initParams: null,
    /**
     * The selector used to identify the DOM element that will contain views
     * @property viewRootSelector
     * @default #view-root
     *
     * @type {String}
     */

    viewRootSelector: &#x27;#view-root&#x27;,
    /**
     * Handler for when the user attempts to navigate to an invalid route
     * @method onInvalidRoute
     *
     * @param {Object} err  The routing error
     */
    onInvalidRoute: function(err) {
      // If the error is equal to &quot;locked&quot;, it means that the router or view manager was
      // busy while while the user was attempting to navigate
      if (err !== &#x27;locked&#x27;) {
        alert(&#x27;An error occurred while trying to display this URL.&#x27;);
      }
    },
    /**
     * Handler for when the user taps on a &lt;A&gt; element
     * @method onTapLink
     *
     * @param {Event} e  The event object
     */
    onTapLink: function(e) {
      var link = $(e.currentTarget),
          defaultPrevented = e.isDefaultPrevented(),
          url = link.attr(&#x27;href&#x27;) || link.attr(&#x27;data-href&#x27;),
          rel = link.attr(&#x27;rel&#x27;),
          target = link.attr(&#x27;target&#x27;),
          isExternal = link.is(&#x27;[data-external]&#x27;) || _isExternal(url),
          metaKey;

      // backwards compatilibity with HammerJS &lt; 2.0
      if (e.type === &#x27;tap&#x27; &amp;&amp; e.gesture &amp;&amp; e.gesture.srcEvent) {
        metaKey = e.gesture.srcEvent.ctrlKey || e.gesture.srcEvent.metaKey;
      } else if (e.type === &#x27;tap&#x27; &amp;&amp; e.originalEvent &amp;&amp; e.originalEvent.gesture &amp;&amp; e.originalEvent.srcEvent) {
        metaKey = e.originalEvent.gesture.srcEvent.ctrlKey || e.originalEvent.gesture.srcEvent.metaKey;
      } else {
        metaKey = e.ctrlKey || e.metaKey;
      }
      if (metaKey) {
        target = metaKey ? &#x27;_blank&#x27; : (target ? target : &#x27;_self&#x27;);
      }

      if (!defaultPrevented) {
        if (Device.isCordova() &amp;&amp; target) {
          e.preventDefault();
          window.open(url, target || &#x27;_blank&#x27;);
        } else if (isExternal || target) {
          window.open(url, target);
          return true;
        } else {
          e.preventDefault();
          if (rel === &#x27;back&#x27;) {
            History.back();
          } else if (rel === &#x27;force-back&#x27; &amp;&amp; url) {
            History.isRoutingBack = true;
            var _always = function() {
              History.isRoutingBack = false;
            };
            this.router.exec(url, null, null).then(_always, _always);
          } else if (rel === &#x27;cancel&#x27;) {
            this.viewManager.dismiss(e.currentTarget);
          } else if (url) {
            url = url.replace(/^\/?#/, &#x27;&#x27;);
            this.router.exec(url).catch(this.onInvalidRoute);
          }
        }
      }
    },
    /**
     * Initializes the application
     * @method init
     *
     * @param {Object} args  Data of any type from a resolved promise returned by Application.beforeInit(). Defaults to null.
     *
     * @return {Promise}  A promise that resolves when the application is ready for use
     */
    init: function(args) {
      /**
       * View manager used to transition between UI states
       * @property viewManager
       * @default null
       *
       * @type {Lavaca.mvc.ViewManager}
       */
      this.viewManager = viewManager.setEl(this.viewRootSelector);
      /**
       * Router used to manage application traffic and URLs
       * @property router
       * @default null
       *
       * @type {Lavaca.mvc.Router}
       */
      this.router = router.setViewManager(this.viewManager);

      this.bindLinkHandler();

      return Promise.resolve()
        .then(function() {
          return this._callback(args);
        }.bind(this))
        .then(function() {
          this.router.startHistory();
          if (!this.router.hasNavigated) {
            if (this.initState) {
              History.replace(this.initState.state, this.initState.title, this.initState.url);
            }
            return this.router.exec(this.initialHashRoute || this.initRoute, this.initState, this.initParams);
          }
        }.bind(this))
        .then(function() {
          this.trigger(&#x27;ready&#x27;);
        }.bind(this));
    },
    /**
     * Binds a global link handler
     * @method bindLinkHandler
     */
    bindLinkHandler: function() {
      var $body = $(document.body),
          type = &#x27;click&#x27;;
      if ($body.hammer) {
        $body = $body.hammer();
        type = &#x27;tap&#x27;;
        $body.on(&#x27;click&#x27;, &#x27;a&#x27;, _stopEvent);
      }
      $body
        .on(type, &#x27;.ui-blocker&#x27;, _stopEvent)
        .on(type, &#x27;a&#x27;, this.onTapLink.bind(this));
    },
    /**
     * Gets initial route based on query string returned by server 302 redirect
     * @property initialStandardRoute
     * @default null
     *
     * @type {String}
     */
    initialHashRoute: (function(hash) {
      return _matchHashRoute(hash);
    })(window.location.hash),
    /**
     * Handles asynchronous requests that need to happen before Application.init() is called in the constructor
     * @method {String} beforeInit
     *
     * @return {Promise}  A promise
     */
    beforeInit: function() {
      return Promise.resolve(null);
    }
  });

  return Application;

});

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
